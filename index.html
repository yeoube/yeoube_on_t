<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeoube_on Typer</title>
    <!-- 모던한 감성을 위한 폰트: Noto Sans KR (본문), Poppins (영문/숫자) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* [CSS - 모던 디자인 스타일] */
        :root {
            --bg-color: #f0f2f5;
            --container-bg: #ffffff;
            --primary-color: #3b82f6;
            --accent-color: #8b5cf6;
            --text-color: #1f2937;
            --untyped-color: #d1d5db;
            --wrong-color: #ef4444;
            --sub-text-color: #6b7280;
            --correct-color: #10b981;
            --font-kr: 'Noto Sans KR', sans-serif;
            --font-en: 'Poppins', sans-serif;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius-lg: 24px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-kr);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            background: var(--container-bg);
            width: 100%;
            max-width: 800px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        /* --- Header & Options --- */
        .header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .title {
            font-weight: 700;
            font-family: var(--font-en);
            font-size: 1.5rem;
            color: var(--text-color);
            letter-spacing: -0.5px;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 12px;
        }

        .option-label {
            font-size: 0.85rem;
            color: var(--sub-text-color);
            font-weight: 500;
        }

        select {
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid transparent;
            font-family: var(--font-kr);
            font-size: 0.9rem;
            background: transparent;
            cursor: pointer;
            color: var(--text-color);
            outline: none;
        }
        select:hover { background: rgba(0,0,0,0.05); }

        .lang-btn {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 6px 14px;
            cursor: pointer;
            font-family: var(--font-kr);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border-radius: 8px;
            color: var(--sub-text-color);
        }

        .lang-btn.active {
            background: var(--text-color);
            color: white;
            border-color: var(--text-color);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .reset-btn-header {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 6px 14px;
            cursor: pointer;
            font-family: var(--font-kr);
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border-radius: 8px;
            color: var(--sub-text-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .reset-btn-header:hover {
            border-color: var(--wrong-color);
            color: var(--wrong-color);
            background: #fef2f2;
        }

        /* --- Cat Animation Area --- */
        .cat-stage {
            width: 100%;
            height: 160px; 
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin-bottom: 20px;
        }

        .vector-cat { 
            width: 140px; 
            height: 140px; 
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: visible; 
        }

        .cat-body { fill: #f3f4f6; stroke: #374151; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
        .cat-feature { fill: none; stroke: #374151; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
        .cat-eyes-fill { fill: #374151; }
        .cat-cheeks { fill: #fca5a5; opacity: 0; transition: opacity 0.3s; }
        .cat-paws { fill: #f3f4f6; stroke: #374151; stroke-width: 2.5; }
        .keyboard { fill: #e5e7eb; stroke: #374151; stroke-width: 2; }
        .key { fill: #ffffff; stroke: #374151; stroke-width: 1.5; }

        /* Rain Cloud Styles */
        .rain-group { opacity: 0; transition: opacity 0.2s; }
        .rain-cloud { fill: #cbd5e1; stroke: #64748b; stroke-width: 2; }
        .raindrop { stroke: #60a5fa; stroke-width: 2; stroke-linecap: round; }

        /* Face & Ears Groups */
        .face-group { display: none; }
        .face-normal { display: block; }
        
        .ears-group { display: none; }
        .ears-normal { display: block; } 
        .ears-folded { display: none; } 

        /* IDLE */
        .cat-stage:not(.cat-typing):not(.cat-happy-typing):not(.cat-error):not(.cat-success) .face-normal .eye-l,
        .cat-stage:not(.cat-typing):not(.cat-happy-typing):not(.cat-error):not(.cat-success) .face-normal .eye-r {
            animation: blink 4s infinite;
            transform-origin: center;
        }

        /* TYPING */
        .cat-typing .paw-l, .cat-happy-typing .paw-l { animation: pawTap 0.2s infinite alternate; }
        .cat-typing .paw-r, .cat-happy-typing .paw-r { animation: pawTap 0.2s 0.1s infinite alternate; }
        
        /* HAPPY TYPING */
        .cat-happy-typing .face-normal { display: none; }
        .cat-happy-typing .face-success { display: block; } 
        .cat-happy-typing .cat-cheeks { opacity: 0.6; }
        .cat-happy-typing .paw-l { animation: pawTap 0.2s infinite alternate; }
        .cat-happy-typing .paw-r { animation: pawTap 0.2s 0.1s infinite alternate; }
        
        /* ERROR */
        .cat-error .face-normal { display: none; }
        .cat-error .face-error { display: block; }
        .cat-error .ears-normal { display: none; }
        .cat-error .ears-folded { display: block; }
        
        .cat-error .vector-cat { animation: winceShake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        .cat-error .cat-cheeks { opacity: 1; fill: #f87171; }
        .cat-error .rain-group { opacity: 1; }
        .cat-error .raindrop { animation: rainFall 0.6s linear infinite; }
        .cat-error .raindrop:nth-child(2) { animation-delay: 0.2s; }
        .cat-error .raindrop:nth-child(3) { animation-delay: 0.4s; }

        /* SUCCESS */
        .cat-success .face-normal { display: none; }
        .cat-success .face-success { display: block; }
        .cat-success .vector-cat { animation: happyJump 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .cat-success .cat-cheeks { opacity: 0.6; }

        @keyframes blink {
            0%, 96% { transform: scaleY(1); }
            98% { transform: scaleY(0.1); }
            100% { transform: scaleY(1); }
        }
        @keyframes pawTap {
            0% { transform: translateY(0); }
            100% { transform: translateY(3px); }
        }
        @keyframes winceShake {
            10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg); }
            20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0) rotate(-2deg); }
            40%, 60% { transform: translate3d(2px, 0, 0) rotate(1deg); }
        }
        @keyframes happyJump {
            0% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-15px) scale(1.05); }
            100% { transform: translateY(0) scale(1); }
        }
        @keyframes rainFall {
            0% { transform: translateY(0); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(15px); opacity: 0; }
        }

        /* --- Stats Board --- */
        .stats-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            width: 100%;
            margin-bottom: 40px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f9fafb;
            padding: 15px 10px;
            border-radius: 12px;
            transition: transform 0.2s;
        }
        .stat-item:hover { transform: translateY(-2px); }
        .stat-label { font-size: 0.75rem; color: var(--sub-text-color); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; }
        .stat-value { font-size: 1.5rem; font-weight: 700; font-family: var(--font-en); color: var(--text-color); }

        /* --- Typing Overlay Area --- */
        .typing-wrapper {
            position: relative;
            width: 100%;
            min-height: 120px;
            margin-bottom: 30px;
            cursor: text;
        }

        .quote-display {
            font-size: 1.6rem;
            line-height: 1.8;
            text-align: left;
            width: 100%;
            user-select: none;
            word-break: keep-all;
            color: var(--untyped-color);
            font-weight: 300;
            white-space: pre-wrap; 
        }

        .quote-display span { 
            position: relative; 
        }

        .quote-display span.correct { 
            color: var(--text-color); 
            font-weight: 400; 
        } 
        
        .quote-display span.incorrect { 
            color: var(--wrong-color); 
            text-decoration: underline; 
            text-decoration-thickness: 2px; 
            font-weight: 400; 
        }

        .quote-display span.incorrect.typed-space {
            background-color: rgba(239, 68, 68, 0.15);
            display: inline-block;
            min-width: 0.5em;
        }

        .quote-display span.active-input {
            color: var(--text-color);
            font-weight: 400;
            text-decoration: none;
        }

        .quote-display span.active-input.typed-space {
            background-color: rgba(59, 130, 246, 0.15);
            display: inline-block;
            min-width: 0.5em;
        }

        .quote-display span.current::before {
            content: '';
            position: absolute;
            left: -1px; 
            top: 15%;
            height: 70%; 
            width: 2px; 
            background-color: var(--primary-color);
            animation: cursorBlink 1s infinite;
        }
        
        @keyframes cursorBlink { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0; } 
        }
        
        #type-input {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; z-index: 10; cursor: text; font-size: 1.6rem;
        }

        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            width: 100%;
            margin-top: 5px;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 0%;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 999px;
        }

        /* --- Result Modal --- */
        .modal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s ease;
            z-index: 20;
        }
        .modal.show { opacity: 1; pointer-events: all; }
        .modal h2 { font-size: 2.5rem; margin-bottom: 30px; background: linear-gradient(to right, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }
        .modal p { font-size: 1.3rem; margin-bottom: 12px; font-weight: 500; color: var(--text-color); }
        .highlight { color: var(--primary-color); font-weight: 800; }
        .restart-btn { margin-top: 40px; padding: 14px 40px; background: var(--text-color); color: white; border: none; border-radius: 12px; font-family: var(--font-kr); font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .restart-btn:hover { transform: translateY(-2px); background: black; }

        /* Notification Toast */
        .toast {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(31, 41, 55, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 999px;
            font-size: 0.95rem;
            font-weight: 500;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        @media (max-width: 600px) {
            .container { padding: 30px 20px; }
            .quote-display { font-size: 1.3rem; }
            .header { flex-direction: column; align-items: flex-start; gap: 15px; }
            .controls { width: 100%; justify-content: space-between; }
            .stats-board { gap: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="title">Yeoube_on Typer</div>
        <div class="controls">
            <div class="option-group">
                <span class="option-label">Goal</span>
                <select id="sentence-count-select" onchange="resetSession()">
                    <option value="10">10</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            
            <button class="reset-btn-header" onclick="resetSession()">
                <span>↻</span> 다시 시작
            </button>

            <div class="option-group" style="background:none; padding:0;">
                <button class="lang-btn active" onclick="setLanguage('ko')">한글</button>
                <button class="lang-btn" onclick="setLanguage('en')">ENG</button>
            </div>
        </div>
    </div>

    <!-- Enhanced Cat Stage -->
    <div class="cat-stage" id="cat-stage">
        <!-- viewBox 위쪽 확장 유지 -->
        <svg class="vector-cat" viewBox="0 -20 100 120" xmlns="http://www.w3.org/2000/svg">
            
            <!-- Rain Cloud Group (머리 위쪽) -->
            <g class="rain-group" transform="translate(0, 0)">
                <path d="M35,-5 Q40,-15 50,-10 Q60,-15 65,-5 Q70,0 60,0 L40,0 Q30,0 35,-5 Z" class="rain-cloud" />
                <line x1="40" y1="2" x2="40" y2="8" class="raindrop" />
                <line x1="50" y1="5" x2="50" y2="11" class="raindrop" />
                <line x1="60" y1="2" x2="60" y2="8" class="raindrop" />
            </g>

            <!-- Keyboard -->
            <g transform="translate(10, 80)">
                <rect x="0" y="0" width="80" height="20" rx="2" class="keyboard" />
                <rect x="5" y="3" width="10" height="6" rx="1" class="key" />
                <rect x="18" y="3" width="10" height="6" rx="1" class="key" />
                <rect x="31" y="3" width="10" height="6" rx="1" class="key" />
                <rect x="44" y="3" width="10" height="6" rx="1" class="key" />
                <rect x="57" y="3" width="10" height="6" rx="1" class="key" />
                <rect x="5" y="11" width="70" height="6" rx="1" class="key" />
            </g>

            <!-- Body -->
            <path d="M25,85 L25,45 Q25,25 50,25 Q75,25 75,45 L75,85 Z" class="cat-body" />
            
            <!-- 1. Normal Ears (쫑긋한 귀) -->
            <g class="ears-group ears-normal">
                <path d="M28,30 L20,10 L45,26" class="cat-body" />
                <path d="M72,30 L80,10 L55,26" class="cat-body" />
            </g>

            <!-- 2. Folded Ears (접힌 귀 - Error State) -->
            <g class="ears-group ears-folded">
                <path d="M28,30 L18,22 L45,26" class="cat-body" /> 
                <path d="M72,30 L82,22 L55,26" class="cat-body" /> 
            </g>
            
            <circle cx="32" cy="58" r="5" class="cat-cheeks" />
            <circle cx="68" cy="58" r="5" class="cat-cheeks" />

            <!-- Paws -->
            <ellipse cx="35" cy="82" rx="8" ry="6" class="cat-paws paw-l" />
            <ellipse cx="65" cy="82" rx="8" ry="6" class="cat-paws paw-r" />

            <!-- Normal Face -->
            <g class="face-group face-normal">
                <circle cx="35" cy="45" r="3.5" class="cat-eyes-fill eye-l" />
                <circle cx="65" cy="45" r="3.5" class="cat-eyes-fill eye-r" />
                <path d="M45,60 Q50,65 55,60" class="cat-feature" /> 
            </g>

            <!-- Error Face -->
            <g class="face-group face-error">
                <path d="M30,42 L38,45 L30,48" class="cat-feature" fill="none" />
                <path d="M70,42 L62,45 L70,48" class="cat-feature" fill="none" />
                <path d="M42,62 Q46,58 50,62 Q54,66 58,62" class="cat-feature" fill="none" />
            </g>

            <!-- Success / Happy Typing -->
            <g class="face-group face-success">
                <path d="M30,45 Q35,40 40,45" class="cat-feature" fill="none" />
                <path d="M60,45 Q65,40 70,45" class="cat-feature" fill="none" />
                <path d="M43,60 Q50,65 57,60" class="cat-feature" fill="none" />
            </g>
        </svg>
    </div>

    <div class="stats-board">
        <div class="stat-item">
            <span class="stat-label">Progress</span>
            <span class="stat-value" id="progress-text">1 / 10</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">WPM</span>
            <span class="stat-value" id="wpm">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">CPM</span>
            <span class="stat-value" id="cpm">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Accuracy</span>
            <span class="stat-value" id="accuracy">100%</span>
        </div>
    </div>

    <div class="typing-wrapper" onclick="document.getElementById('type-input').focus()">
        <div class="quote-display" id="quote-display"></div>
        <input type="text" id="type-input" autocomplete="off">
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>

    <div class="toast" id="toast">Next Quote ✨</div>

    <div class="modal" id="result-modal">
        <h2>Session Complete</h2>
        <p>Avg WPM: <span id="final-wpm">0</span></p>
        <p>Avg CPM: <span id="final-cpm">0</span></p>
        <p>Best CPM: <span id="best-cpm" class="highlight">0</span></p>
        <p>Accuracy: <span id="final-acc">0</span>%</p>
        <button class="restart-btn" onclick="resetSession()">Restart Journey</button>
    </div>
</div>

<script>
    // --- 데이터: 명언 (사용자 제공 200문장 + 기존) ---
    const quotes = {
        ko: [
            "하루를 버틴 것만으로도 충분히 잘한 것이다.",
            "작은 숨 고르기가 큰 변화를 만든다.",
            "마음이 복잡한 날엔 속도를 줄이는 게 용기다.",
            "한 걸음이어도 계속 나아가면 길이 된다.",
            "가벼운 결심도 꾸준하면 힘을 갖는다.",
            "오늘의 선택이 내일의 방향을 바꾼다.",
            "멈춘다는 건 포기가 아니라 준비일 때가 많다.",
            "마음이 시끄러울수록 조용한 시간을 가져라.",
            "흔들렸다는 건 아직 버티고 있다는 뜻이다.",
            "단단함은 부드러움 속에서 자란다.",
            "오늘을 가볍게 만드는 건 작은 여유다.",
            "기다림도 때로는 중요한 답이다.",
            "어제보다 나아지지 않아도 괜찮다.",
            "지친 마음을 숨기지 말고 쉬어가도 된다.",
            "중요한 건 빠름이 아니라 방향이다.",
            "작아 보이는 변화가 오래 남는다.",
            "불안은 준비되지 않은 게 아니라 중요하기 때문이다.",
            "마음이 식어 보일 때, 새로운 시작이 가까워진다.",
            "사람은 결국 자신이 믿는 쪽으로 자란다.",
            "오늘의 작은 용기가 내일의 큰 선택을 만든다.",
            "쉽게 온 건 쉽게 떠난다.",
            "마음에 남는 건 결국 정성이다.",
            "오래된 고민도 표현하면 절반은 가벼워진다.",
            "새로운 길은 망설임 끝에서 시작된다.",
            "완벽함보다 진심이 오래 간다.",
            "사소한 기쁨이 하루를 지탱한다.",
            "괜찮아지는 데는 시간이 필요하다.",
            "감정은 억누르지 말고 흘려보내야 한다.",
            "흔들렸던 날들이 단단함을 만든다.",
            "포기는 실패가 아니라 선택이다.",
            "나를 아끼는 법을 알면 삶이 덜 버겁다.",
            "작은 배려가 하루 전체를 바꾼다.",
            "외로움은 새로운 관계를 부르는 신호다.",
            "조급한 마음은 결국 나를 지치게 한다.",
            "아무 말 없이 곁에 있는 사람은 소중하다.",
            "마음이 어두우면 밝은 길도 흐릿해 보인다.",
            "어려움도 지나가고, 평온도 지나간다.",
            "말보다 행동이 진심을 증명한다.",
            "도망치고 싶을 때는 잠시 멈추는 것만으로 충분하다.",
            "내가 할 수 있는 만큼만 해도 이미 잘한 것이다.",
            "어제의 실수는 오늘의 방향을 가르쳐 준다.",
            "버티는 시간도 결국 성장의 일부다.",
            "나를 믿는 법을 배우는 데는 시간이 걸린다.",
            "중요한 건 잘하려는 마음이다.",
            "실패는 다른 문을 여는 열쇠다.",
            "천천히 가도 도착한다.",
            "감정은 정답보다 이해가 필요하다.",
            "나에게 엄격할수록 마음은 더 지친다.",
            "작게 시작한 마음이 오래 간다.",
            "후회는 배우게 하고, 배움은 단단하게 한다.",
            "진실함은 언제나 제자리로 돌아온다.",
            "너무 멀리 보지 말고 지금을 걸어라.",
            "가벼운 포기는 새로운 선택의 여지를 준다.",
            "변하지 않는 건 변한다는 사실뿐이다.",
            "마음이 열리면 가능성이 열린다.",
            "바쁜 하루에도 나를 위한 한 순간은 필요하다.",
            "나를 꾸짖기보다 달래는 게 먼저다.",
            "변화는 불편함에서 시작된다.",
            "잘 모를 때는 잠시 멈춰도 된다.",
            "마음의 무게는 나눌 때 줄어든다.",
            "언젠가는 오늘의 고민이 미소가 된다.",
            "완벽하지 않아도 괜찮다는 말이 위로가 된다.",
            "작은 성공도 크게 축하해도 된다.",
            "쉬어가는 건 성장의 한 방식이다.",
            "새로운 하루는 항상 다시 선택할 기회를 준다.",
            "삶은 단순할수록 선명하다.",
            "행복은 거창하게 오지 않는다.",
            "마음을 다치게 하는 사람에게서 멀어져도 된다.",
            "필요 없는 관계는 용기 내어 비워야 한다.",
            "자신을 믿는 순간 가능성이 열린다.",
            "슬픔도 기쁨도 살아 있다는 증거다.",
            "지금의 나도 충분히 의미 있다.",
            "마음을 들여다보는 시간은 낭비가 아니다.",
            "감당할 수 없는 일이면 잠시 내려놓아도 된다.",
            "원하지 않는 길도 때로는 필요한 길일 수 있다.",
            "매일을 똑같이 살지 않아도 된다.",
            "오래된 상처일수록 천천히 다뤄야 한다.",
            "나에게 가장 맞는 속도는 내가 정한다.",
            "더 늦기 전에가 아니라, 지금이 적절한 때다.",
            "사랑은 주는 만큼 돌아오지 않아도 된다.",
            "오늘의 나를 좋아하는 연습이 필요하다.",
            "마음이 향하는 곳에 답이 있다.",
            "지나온 시간을 미워하지 마라.",
            "혼란은 새로운 나를 만드는 과정이다.",
            "스스로를 칭찬하는 건 어색하지만 중요하다.",
            "실수도 용납해 줄 수 있을 때 성숙해진다.",
            "진심은 느린 속도로 전달된다.",
            "인연은 오래 남기도, 금방 지나가기도 한다.",
            "기대를 낮추면 여유가 생긴다.",
            "중요한 건 다시 시작하는 것이다.",
            "마음이 지칠 때는 멈춰도 괜찮다.",
            "오래 버틴 만큼 강해진다.",
            "새로운 길이 두려운 건 자연스러운 일이다.",
            "오늘을 최선을 다해 살면 내일이 달라진다.",
            "기다림은 결국 의미를 만든다.",
            "삶이란 배우는 과정의 반복이다.",
            "작은 위로가 큰 힘이 된다.",
            "스스로에게 친절한 사람이 결국 멀리 간다.",
            "행복은 선택이고 연습이다.",
            "마음을 돌보는 건 삶을 돌보는 일이다.",
            "어둠이 있어야 빛이 보인다.",
            "실수도 경험이 된다.",
            "때로는 말보다 침묵이 더 많은 것을 전한다.",
            "나를 지키는 경계는 필요하다.",
            "사람의 마음은 시간이 증명한다.",
            "후회는 지나간 길을 반짝이게 만든다.",
            "내가 원하는 삶은 내가 만든다.",
            "매일의 작고 단순한 일이 행복이 된다.",
            "문제를 피한다고 사라지지 않는다.",
            "마음이 열리면 관계도 열린다.",
            "오래된 일에 매달리면 새로운 일에 손을 못 댄다.",
            "스스로에게 솔직해질 때 편안해진다.",
            "천천히 가는 날도 소중하다.",
            "기대가 큰 만큼 상처도 깊다.",
            "마음의 소음은 시간이 줄여 준다.",
            "용서는 상대가 아니라 나를 위한 일이다.",
            "상처는 시간이 아니라 이해로 아문다.",
            "배움은 끝이 없다.",
            "익숙함에 속아 머물지 마라.",
            "오래된 습관은 천천히 바뀐다.",
            "나를 믿어 주는 한 사람이 삶을 바꾼다.",
            "감정은 느껴도 되고 말해도 된다.",
            "완벽하려는 욕심을 내려놓아야 편해진다.",
            "마음의 무게는 가벼워질 수 있다.",
            "다시 시작하는 데 나이는 중요하지 않다.",
            "비교는 행복을 훔친다.",
            "지금의 나는 과거의 내가 꿈꾸던 모습일 수 있다.",
            "일상이 흔들릴 때 마음도 흔들린다.",
            "좋은 사람은 말보다 태도가 먼저다.",
            "마음을 닫으면 모든 가능성이 닫힌다.",
            "후회는 잠시지만 포기는 오래 남는다.",
            "아직 오지 않은 미래를 걱정하지 마라.",
            "돌아가는 길도 나쁘지 않다.",
            "기다림 끝에 오는 건 작은 변화일 수 있다.",
            "나를 아끼는 마음이 모든 관계의 시작이다.",
            "느린 사람도 제 속도가 있다.",
            "중요한 건 힘든 날에도 나를 잃지 않는 것이다.",
            "슬픔은 감추는 게 아니라 다루는 것이다.",
            "마음이 닫히면 말도 멀어진다.",
            "내가 원하는 건 때로 아주 단순하다.",
            "감정은 흐르는 것이지 붙잡는 게 아니다.",
            "스스로를 탓하기보다 이해하려고 노력하라.",
            "멀리 보고 싶다면 먼저 멈춰 서라.",
            "바람처럼 스쳐 지나간 일도 의미를 남긴다.",
            "성장에는 고요한 시간이 필요하다.",
            "나는 내가 생각하는 것보다 강하다.",
            "작은 친절이 큰 위로가 된다.",
            "열심히 살지 않아도 괜찮다.",
            "마음이 원하는 길을 따라가라.",
            "삶은 다시 시작할 수 있다는 사실로 희망을 준다.",
            "지나간 시간을 놓아줄 때 지금이 보인다.",
            "마음의 평화는 내가 만들어야 한다.",
            "원하는 걸 말해야 원하는 걸 얻는다.",
            "나를 힘들게 하는 관계는 멀어져도 된다.",
            "오늘의 나를 인정하는 연습이 필요하다.",
            "불안함도 나의 일부다.",
            "서로를 이해할 때 관계는 깊어진다.",
            "감정이 깊을수록 말은 조심스러워진다.",
            "나를 위한 시간은 사치가 아니다.",
            "작은 휴식이 큰 차이를 만든다.",
            "모든 것은 지나간다.",
            "흔들리는 날도 삶의 일부다.",
            "무너지는 건 다시 세울 수 있다는 뜻이다.",
            "마음이 투명해지면 세상도 맑아진다.",
            "괜찮지 않아도 괜찮다.",
            "포기하지 않으면 길은 열린다.",
            "새로운 배움은 나를 확장시킨다.",
            "상처를 인정해야 치유가 시작된다.",
            "내일의 나는 오늘의 선택에서 자란다.",
            "내가 바뀌면 세상도 달라 보인다.",
            "행복은 생각보다 가까운 곳에 있다.",
            "말은 상처가 되기도, 위로가 되기도 한다.",
            "깊은 외로움은 새로운 만남을 부른다.",
            "노력은 배신하지 않는다.",
            "마음의 힘은 고요함에서 나온다.",
            "현재에 집중하면 미래도 편안해진다.",
            "삶은 예측할 수 없기에 흥미롭다.",
            "선택은 책임을 함께 데려온다.",
            "포용은 성숙의 증거다.",
            "오늘의 배움이 내일의 강함이 된다.",
            "마음의 상처는 이해받을 때 아문다.",
            "진심은 시간이 흘러도 남는다.",
            "관계는 노력보다 태도가 더 중요하다.",
            "사랑은 표현할수록 깊어진다.",
            "혼자가 익숙해도 함께가 그립다.",
            "마음을 다해 들으면 상대도 마음을 연다.",
            "상처받지 않으려면 적당한 거리가 필요하다.",
            "작은 기대는 큰 실망을 막는다.",
            "내일을 두려워하지 마라.",
            "한 번의 실수로 나를 규정하지 마라.",
            "말하지 않으면 전달되지 않는다.",
            "너무 오래 분노를 붙들지 마라.",
            "사람은 결국 자신이 사랑한 것을 닮아 간다.",
            "마음이 예민한 건 나쁜 게 아니다.",
            "행복은 현재를 사랑하는 기술이다.",
            "나를 있는 그대로 받아들일 때 편안해진다.",
            "세상은 여전히 배울 것이 많다.",
            "지금 이 순간도 지나갈 것이다.",
            "마음의 온도는 스스로 지켜야 한다.",
            "오늘도 살아낸 나에게 감사하라."
        ],
        en: [
            "The only way to do great work is to love what you do.",
            "Knowing yourself is the beginning of all wisdom.",
            "He who has a why to live can bear almost any how.",
            "Life is not a problem to be solved, but a reality to be experienced.",
            "The unexamined life is not worth living.",
            "Happiness depends upon ourselves.",
            "What lies behind us and what lies before us are tiny matters.",
            "The purpose of life is a life of purpose.",
            "Change is the end result of all true learning.",
            "It is during our darkest moments that we must focus to see the light.",
            "Do not go where the path may lead, go instead where there is no path and leave a trail.",
            "In three words I can sum up everything I've learned about life: it goes on.",
            "To be yourself in a world that is constantly trying to make you something else is the greatest accomplishment.",
            "You only live once, but if you do it right, once is enough.",
            "The best way to predict the future is to create it.",
            "Success is not final, failure is not fatal: it is the courage to continue that counts.",
            "Be the change that you wish to see in the world.",
            "A journey of a thousand miles begins with a single step.",
            "Believe you can and you're halfway there.",
            "Act as if what you do makes a difference. It does."
        ]
    };

    // --- 상태 변수 ---
    let currentLang = 'ko';
    let targetCount = 10;
    let completedCount = 0;
    
    let currentStartTime = null;
    let currentSentenceKeystrokes = 0;
    let currentSentenceErrors = 0;
    
    let historyWPM = [];
    let historyCPM = [];
    let historyACC = [];

    let currentQuote = "";
    let isTyping = false;
    let timerInterval = null;
    let typingTimeout;

    // --- DOM ---
    const quoteDisplay = document.getElementById('quote-display');
    const typeInput = document.getElementById('type-input');
    const wpmEl = document.getElementById('wpm');
    const cpmEl = document.getElementById('cpm');
    const accEl = document.getElementById('accuracy');
    const progressText = document.getElementById('progress-text');
    const progressFill = document.getElementById('progress-fill');
    const modal = document.getElementById('result-modal');
    const catStage = document.getElementById('cat-stage');
    const langBtns = document.querySelectorAll('.lang-btn');
    const countSelect = document.getElementById('sentence-count-select');
    const toast = document.getElementById('toast');

    // --- 유틸리티: 한글 타수 계산 ---
    function getWeightedLength(str) {
        let length = 0;
        for (let i = 0; i < str.length; i++) {
            const code = str.charCodeAt(i);
            if (code >= 0xAC00 && code <= 0xD7A3) {
                const hangul = code - 0xAC00;
                const jong = hangul % 28;
                length += (jong > 0 ? 3 : 2);
            } else {
                length += 1;
            }
        }
        return length;
    }

    // --- 초기화 ---
    function resetSession() {
        targetCount = parseInt(countSelect.value);
        currentLang = document.querySelector('.lang-btn.active').innerText.includes('한') ? 'ko' : 'en';

        historyWPM = [];
        historyCPM = [];
        historyACC = [];
        completedCount = 0;
        
        modal.classList.remove('show');
        resetCat();
        updateStatsUI(0, 0, 100);
        updateProgressText();
        
        loadNextQuote();
    }

    function loadNextQuote() {
        clearInterval(timerInterval);
        isTyping = false;
        currentStartTime = null; 
        currentSentenceKeystrokes = 0;
        currentSentenceErrors = 0;

        typeInput.value = "";
        typeInput.disabled = false;
        progressFill.style.width = '0%';
        
        const quoteList = quotes[currentLang];
        currentQuote = quoteList[Math.floor(Math.random() * quoteList.length)];
        
        quoteDisplay.innerHTML = '';
        currentQuote.split('').forEach(char => {
            const span = document.createElement('span');
            span.innerText = char;
            span.dataset.original = char;
            quoteDisplay.appendChild(span);
        });
        
        if (quoteDisplay.firstChild) {
            quoteDisplay.firstChild.classList.add('current');
        }

        typeInput.focus();
    }

    function setLanguage(lang) {
        langBtns.forEach(btn => {
            const isKo = btn.innerText.includes('한');
            if (lang === 'ko' && isKo) btn.classList.add('active');
            else if (lang === 'en' && !isKo) btn.classList.add('active');
            else btn.classList.remove('active');
        });
        resetSession();
    }

    function updateProgressText() {
        progressText.innerText = `${completedCount + 1} / ${targetCount}`;
    }

    // --- 타이머 & 통계 ---
    function startTimer() {
        if (!isTyping) {
            isTyping = true;
            updateStatsUI(0, 0, 100); 
            currentStartTime = new Date(); 
            timerInterval = setInterval(calculateCurrentStats, 500); 
        }
    }

    function calculateCurrentStats() {
        if (!currentStartTime) return { wpm: 0, cpm: 0, acc: 100 };
        const now = new Date();
        const timeElapsedMin = (now - currentStartTime) / 60000; 
        if (timeElapsedMin <= 0) return { wpm: 0, cpm: 0, acc: 100 };

        const weightedLength = getWeightedLength(typeInput.value);
        if (weightedLength === 0) return { wpm: 0, cpm: 0, acc: 100 };

        const cpm = Math.round(weightedLength / timeElapsedMin);
        const wpm = Math.round((weightedLength / 5) / timeElapsedMin); 
        
        let accuracy = 0;
        if (currentSentenceKeystrokes > 0) {
            accuracy = Math.round(((currentSentenceKeystrokes - currentSentenceErrors) / currentSentenceKeystrokes) * 100);
            if (accuracy < 0) accuracy = 0;
        } else {
            accuracy = 100;
        }

        updateStatsUI(wpm, cpm, accuracy);
        return { wpm, cpm, accuracy };
    }

    function updateStatsUI(wpm, cpm, acc) {
        wpmEl.innerText = isNaN(wpm) || !isFinite(wpm) ? 0 : wpm;
        cpmEl.innerText = isNaN(cpm) || !isFinite(cpm) ? 0 : cpm;
        accEl.innerText = acc;
    }

    // --- 고양이 상태 ---
    function setCatState(state) {
        catStage.className = 'cat-stage';
        if (state) catStage.classList.add(`cat-${state}`);
        
        // 타이핑이나 에러 상태가 지속되지 않도록 타임아웃
        clearTimeout(typingTimeout);
        if (state === 'typing' || state === 'happy-typing' || state === 'error') {
            typingTimeout = setTimeout(() => {
                if (isTyping) catStage.className = 'cat-stage'; 
            }, 500);
        }
    }
    function resetCat() { catStage.className = 'cat-stage'; }

    // --- 입력 핸들링 ---
    typeInput.addEventListener('input', (e) => {
        startTimer();
        currentSentenceKeystrokes++; 

        const inputVal = typeInput.value;
        const spans = quoteDisplay.querySelectorAll('span');
        const currentIndex = inputVal.length - 1;

        // 1. 전체 스타일 리셋
        spans.forEach((span, idx) => {
            span.classList.remove('current'); 
            // [수정] 클래스 초기화 시 모든 커스텀 클래스 제거
            span.classList.remove('active-input', 'correct', 'incorrect', 'typed-space');
            
            if (idx >= inputVal.length) {
                span.className = '';
                span.innerText = span.dataset.original; 
            }
        });

        // 2. 입력된 글자 처리
        for (let i = 0; i < inputVal.length; i++) {
            if (i >= spans.length) break;
            const typedChar = inputVal[i];
            const targetChar = currentQuote[i];
            const span = spans[i];
            const isLastChar = (i === inputVal.length - 1);

            // 공백 입력 시 시각적 표시
            if (typedChar === ' ') {
                span.classList.add('typed-space');
            }

            if (isLastChar) {
                span.className = 'active-input';
                // [수정] 입력 중일 때, 공백이면 원문 유지, 아니면 입력한 글자 표시
                span.innerText = (typedChar === ' ') ? span.dataset.original : typedChar;
            } else {
                if (typedChar === targetChar) {
                    span.className = 'correct';
                    span.innerText = span.dataset.original; 
                } else {
                    span.className = 'incorrect';
                    // [수정] 오타일 때, 공백이면 원문 유지, 아니면 입력한 글자 표시
                    span.innerText = (typedChar === ' ') ? span.dataset.original : typedChar; 
                }
            }
        }

        // 3. 커서 이동
        if (inputVal.length < currentQuote.length) {
            spans[inputVal.length].classList.add('current');
        }

        // 입력 길이 제한
        if (currentIndex >= currentQuote.length) {
            typeInput.value = inputVal.slice(0, currentQuote.length);
            return;
        }

        // 진행바
        const progress = (inputVal.length / currentQuote.length) * 100;
        progressFill.style.width = `${progress}%`;

        // 4. 고양이 반응
        if (inputVal.length > 0) {
            const lastTypedChar = inputVal[currentIndex];
            const lastTargetChar = currentQuote[currentIndex];
            
            if (e.isComposing || lastTypedChar === lastTargetChar) {
                const progressRatio = inputVal.length / currentQuote.length;
                if (progressRatio >= 0.85) { 
                    setCatState('happy-typing');
                } else {
                    setCatState('typing');
                }
            } else {
                currentSentenceErrors++; 
                setCatState('error');
            }
        }

        // 자동 완료 체크
        if (inputVal.length === currentQuote.length && inputVal === currentQuote) {
            finishSentence();
        }
    });

    typeInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault(); 
            if (typeInput.value.length === 0) return;
            finishSentence();
        }
    });

    // --- 문장 완료 ---
    function finishSentence() {
        const finalStats = calculateCurrentStats(); 
        clearInterval(timerInterval); 

        historyWPM.push(finalStats.wpm);
        historyCPM.push(finalStats.cpm);
        historyACC.push(finalStats.accuracy);

        completedCount++;
        setCatState('success');

        if (completedCount >= targetCount) {
            finishSession();
        } else {
            showToast();
            // [수정] setTimeout 제거하여 즉시 실행 (입력 버퍼 문제 해결)
            updateProgressText();
            loadNextQuote();
        }
    }

    function showToast() {
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 1500);
    }

    function finishSession() {
        clearInterval(timerInterval);
        isTyping = false;
        typeInput.disabled = true;
        
        const avgWPM = historyWPM.length > 0 
            ? Math.round(historyWPM.reduce((a, b) => a + b, 0) / historyWPM.length) 
            : 0;
        const avgCPM = historyCPM.length > 0 
            ? Math.round(historyCPM.reduce((a, b) => a + b, 0) / historyCPM.length) 
            : 0;
        const avgACC = historyACC.length > 0 
            ? Math.round(historyACC.reduce((a, b) => a + b, 0) / historyACC.length) 
            : 0;
        const maxCPM = historyCPM.length > 0 ? Math.max(...historyCPM) : 0;

        document.getElementById('final-wpm').innerText = avgWPM;
        document.getElementById('final-cpm').innerText = avgCPM; 
        document.getElementById('best-cpm').innerText = maxCPM;   
        document.getElementById('final-acc').innerText = avgACC;
        
        modal.classList.add('show');
    }

    resetSession();

</script>
</body>
</html>